<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Dolly: Clone Chaos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Import a weird, cartoony sci-fi font -->
    <link href="https://fonts.googleapis.com/css2?family=Gloria+Hallelujah&family=Orbitron:wght@700&display=swap" rel="stylesheet">

    <style>
        /* RICK AND MORTY STYLE THEME */
        :root {
            --toxic-green: #39ff14;
            --portal-green: #bfff00;
            --rick-blue: #00b5cc;
            --dark-matter: #1a1a2e;
            --purple-haze: #4a0e4e;
        }

        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden; /* Prevent scrollbars causing layout shifts */
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Gloria Hallelujah', cursive;
            background-color: var(--dark-matter);
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(57, 255, 20, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(74, 14, 78, 0.2) 0%, transparent 60%),
                linear-gradient(to right, rgba(0,0,0,0.8), rgba(0,0,0,0.8)),
                url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zM32 63c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm57-13c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%2339ff14' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
            color: #e2e8f0;
            backface-visibility: hidden; 
            transform: translateZ(0);
        }

        h1, .tech-font { font-family: 'Orbitron', sans-serif; letter-spacing: 2px; }

        /* INTRO VIDEO LAYER */
        #intro-layer {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: black;
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            transition: opacity 1s ease-out;
        }

        #intro-video {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: none;
        }

        #start-screen {
            text-align: center;
            z-index: 101;
        }

        /* HIDE GAME CONTENT INITIALLY */
        #game-container {
            display: none;
            opacity: 0;
            transition: opacity 1s ease-in;
            width: 100%;
            height: 100%;
            overflow-y: auto; 
        }

        /* --- GAME STYLES --- */
        .perspective-1000 { perspective: 1000px; }
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55); 
            transform-style: preserve-3d;
            cursor: pointer;
            will-change: transform; 
        }
        .card.flipped .card-inner, .card.matched .card-inner { transform: rotateY(180deg); }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            /* Removed border and adjusted shadow to just be depth */
            box-shadow: 0 4px 8px rgba(0,0,0,0.5);
            background-color: transparent; /* Fix for white border */
            overflow: hidden;
        }

        .card-front {
            background-image: url('CardBack.png');
            background-size: 100% 100%; /* Force exact fit */
            background-repeat: no-repeat;
            background-position: center;
            background-color: transparent; /* Fix for white border */
            
            animation: portal-pulse 2s infinite alternate;
            will-change: box-shadow;
        }

        @keyframes portal-pulse {
            0% { box-shadow: inset 0 0 5px var(--toxic-green); }
            100% { box-shadow: inset 0 0 15px var(--portal-green); }
        }

        .card-back {
            background-color: #f0fce7;
            transform: rotateY(180deg);
            /* Keep border here only if you want it on the face side, remove if you want full bleed image there too */
            border: 2px solid var(--rick-blue);
        }

        .card.matched .card-back {
            border-color: var(--toxic-green);
            background-color: #dcfce7;
            box-shadow: 0 0 20px var(--toxic-green);
        }

        .matched-slime {
            position: absolute;
            top: -10px; left: -10px; right: -10px; bottom: -10px;
            pointer-events: none; opacity: 0;
            transition: opacity 0.3s;
            background-image: url("data:image/svg+xml,%3Csvg width='100%25' height='100%25' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 20C7.58 20 4 16.42 4 12C4 7.58 7.58 4 12 4C16.42 4 20 7.58 20 12C20 16.42 16.42 20 12 20Z' fill='%2339ff14' fill-opacity='0.5'/%3E%3C/svg%3E");
            background-size: cover;
        }
        .card.matched .matched-slime { opacity: 1; animation: slime-drip 2s infinite; }
        
        .cartoon-svg {
            width: 100%; height: 100%;
            stroke: black; stroke-width: 2.5px; stroke-linecap: round; stroke-linejoin: round;
            filter: drop-shadow(2px 2px 0px rgba(0,0,0,0.5));
        }

        .card.merging { z-index: 50; animation: merge-fly 1.2s cubic-bezier(0.22, 1, 0.36, 1) forwards; }
        .card.merging .card-inner { animation: merge-glow 1.2s ease-in-out forwards; }

        @keyframes merge-fly {
            0% { transform: translate(0, 0) rotate(var(--rot-start)); }
            40% { transform: translate(var(--tx), var(--ty)) scale(1.1) rotate(0deg); }
            60% { transform: translate(var(--tx), var(--ty)) scale(1.1) rotate(0deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }

        @keyframes merge-glow {
            0% { box-shadow: none; border-color: var(--rick-blue); }
            40% { box-shadow: 0 0 40px var(--toxic-green), 0 0 80px var(--portal-green); border-color: white; filter: brightness(1.5); }
            60% { box-shadow: 0 0 60px var(--toxic-green), 0 0 100px var(--portal-green); border-color: white; filter: brightness(1.2); }
            100% { box-shadow: none; border-color: var(--toxic-green); }
        }
        
        /* EXACT CARD RATIO 153x230 */
        .card-custom-ratio {
            aspect-ratio: 153 / 230;
        }
    </style>
</head>
<body class="flex flex-col items-center justify-start pt-8 p-4">

    <!-- INTRO LAYER -->
    <div id="intro-layer">
        <div id="start-screen">
            <h1 class="text-4xl md:text-6xl text-[var(--toxic-green)] mb-8 tech-font font-extrabold drop-shadow-[0_0_20px_rgba(57,255,20,0.5)]">
                PROJECT DOLLY
            </h1>
            <button id="start-btn" class="px-8 py-4 bg-[var(--rick-blue)] hover:bg-[var(--toxic-green)] border-4 border-black text-black font-extrabold text-2xl rounded-xl transition-all hover:scale-110 active:scale-95 shadow-[0_0_30px_rgba(0,181,204,0.6)] flex items-center gap-3 mx-auto">
                <i data-lucide="play" class="w-8 h-8 fill-black"></i>
                INITIATE PROTOCOL
            </button>
        </div>
        <video id="intro-video" src="intro.mp4" playsinline style="display: none;"></video>
    </div>

    <!-- WRAPPER FOR GAME CONTENT -->
    <div id="game-container">
        <!-- Header -->
        <header class="w-full max-w-4xl flex flex-col md:flex-row justify-between items-center mb-4 z-10 relative mx-auto">
            <div class="text-center md:text-left mb-4 md:mb-0 bg-black/40 p-3 rounded-2xl border-4 border-black -rotate-2">
                <h1 class="text-2xl md:text-3xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-[var(--toxic-green)] to-[var(--rick-blue)] drop-shadow-[2px_2px_0px_rgba(0,0,0,1)]">
                    PROJECT DOLLY
                </h1>
                <p class="text-xs text-[var(--portal-green)] mt-1 font-bold">RESTORATION PROTOCOL</p>
            </div>
            
            <div class="flex gap-4 bg-black/60 p-3 rounded-xl border-4 border-[var(--purple-haze)] backdrop-blur-md rotate-1">
                <div class="text-center">
                    <p class="text-[9px] text-[var(--rick-blue)] uppercase font-bold">Moves</p>
                    <p id="move-count" class="text-xl font-extrabold text-[var(--toxic-green)] tech-font">0</p>
                </div>
                <div class="w-1 bg-[var(--purple-haze)] rounded-full"></div>
                <div class="text-center">
                    <p class="text-[9px] text-[var(--rick-blue)] uppercase font-bold">Time</p>
                    <p id="timer" class="text-xl font-extrabold text-[var(--toxic-green)] tech-font">00:00</p>
                </div>
                <div class="w-1 bg-[var(--purple-haze)] rounded-full"></div>
                <div class="text-center flex items-center">
                    <button onclick="restartGame()" class="p-2 bg-[var(--rick-blue)] hover:bg-[var(--toxic-green)] border-2 border-black rounded-full transition-all group active:translate-y-1" title="Restart">
                        <i data-lucide="skull" class="w-5 h-5 text-black group-hover:animate-spin"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Game Grid -->
        <main class="w-full max-w-5xl z-10 relative mb-4 mx-auto px-2">
            <div class="bg-yellow-300/90 border-4 border-black p-2 text-black text-center font-bold mb-4 rounded-lg -rotate-1 mx-auto max-w-md shadow-[4px_4px_0px_rgba(0,0,0,1)] text-xs md:text-sm">
                MATCH ORIGINAL WITH CLONE TO RESTORE!
            </div>

            <div id="game-grid" class="grid grid-cols-4 gap-2 md:gap-4 w-full mx-auto perspective-1000 p-3 bg-black/30 rounded-3xl border-4 border-[var(--toxic-green)]">
                <!-- Cards will be injected here by JS -->
            </div>
        </main>
    </div>

    <!-- Victory Modal -->
    <div id="victory-modal" class="fixed inset-0 bg-black/90 backdrop-blur-md z-50 hidden flex items-center justify-center p-4">
        <div class="bg-[var(--dark-matter)] border-8 border-[var(--toxic-green)] p-8 rounded-3xl max-w-md w-full text-center shadow-[0_0_50px_var(--toxic-green)] transform scale-90 opacity-0 transition-all duration-300 relative overflow-hidden" id="modal-content">
            <div class="relative z-10">
                <div class="inline-block p-4 rounded-full bg-[var(--toxic-green)] border-4 border-black mb-4 animate-bounce">
                    <i data-lucide="flask-conical" class="w-16 h-16 text-black fill-current"></i>
                </div>
                <h2 class="text-4xl font-extrabold text-[var(--toxic-green)] mb-2 tech-font drop-shadow-[2px_2px_0px_black]">EXPERIMENT SUCCESS!</h2>
                <div class="grid grid-cols-2 gap-4 mb-8">
                    <div class="bg-black/50 p-4 rounded-xl border-2 border-[var(--rick-blue)]">
                        <p class="text-xs text-[var(--portal-green)] uppercase">Moves</p>
                        <p id="final-moves" class="text-3xl font-extrabold text-white tech-font">0</p>
                    </div>
                    <div class="bg-black/50 p-4 rounded-xl border-2 border-[var(--rick-blue)]">
                        <p class="text-xs text-[var(--portal-green)] uppercase">Time</p>
                        <p id="final-time" class="text-3xl font-extrabold text-white tech-font">00:00</p>
                    </div>
                </div>

                <button onclick="restartGame()" class="w-full py-4 bg-[var(--toxic-green)] hover:bg-[var(--portal-green)] border-4 border-black text-black font-extrabold text-xl rounded-xl transition-all flex items-center justify-center gap-2 active:translate-y-1 shadow-[4px_4px_0px_black]">
                    <i data-lucide="zap" class="w-6 h-6 fill-current"></i>
                    AGAIN!
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- ASSETS ---
        const pairedAssets = [
            {
                type: 'dolly',
                original: {
                    name: 'Dolly',
                    img: 'CardSheepNormal.png',
                    svg: `<svg viewBox="0 0 64 64" fill="none" class="cartoon-svg"><path d="M18 24C14 24 10 28 10 34C10 40 14 46 18 46C20 50 24 52 30 52C36 52 40 50 42 46C46 46 50 40 50 34C50 28 46 24 42 24C40 20 36 18 30 18C24 18 20 20 18 24Z" fill="#FFFFFF" stroke="black" stroke-width="3"/><circle cx="50" cy="34" r="10" fill="#FFD1DC" stroke="black" stroke-width="3"/><circle cx="47" cy="32" r="2" fill="black"/> <circle cx="53" cy="32" r="2" fill="black"/><path d="M48 38 Q50 40 52 38" stroke="black" stroke-width="2" fill="none"/><rect x="20" y="50" width="6" height="10" fill="#FFD1DC" stroke="black" stroke-width="3"/><rect x="34" y="50" width="6" height="10" fill="#FFD1DC" stroke="black" stroke-width="3"/></svg>`
                },
                clone: {
                    name: 'Dolly Clone',
                    img: 'CardSheepMonster.png',
                    svg: `<svg viewBox="0 0 64 64" fill="none" class="cartoon-svg"><path d="M14 28C10 32 8 40 12 48C16 56 24 58 32 56C40 58 48 54 52 46C56 38 54 30 48 26C42 18 34 16 26 18C18 16 16 22 14 28Z" fill="#C8E6C9" stroke="black" stroke-width="3"/><circle cx="48" cy="24" r="8" fill="#A5D6A7" stroke="black" stroke-width="3"/><circle cx="45" cy="22" r="1.5" fill="red"/> <circle cx="51" cy="22" r="2.5" fill="red"/><path d="M18 48 Q 14 56 22 58 Q 26 54 24 46" fill="#81C784" stroke="black" stroke-width="3"/><circle cx="20" cy="52" r="2" fill="white"/><path d="M30 56 L30 62 M36 56 L36 60 M42 54 L42 62" stroke="#39ff14" stroke-width="3" stroke-linecap="round"/></svg>`
                }
            },
            {
                type: 'coffee',
                original: {
                    name: 'Coffee Machine',
                    img: 'CardCoffeeNormal.png',
                    svg: `<svg viewBox="0 0 64 64" fill="none" class="cartoon-svg"><rect x="16" y="12" width="32" height="40" rx="4" fill="#37474F" stroke="black" stroke-width="3"/><rect x="20" y="24" width="24" height="20" rx="2" fill="#CFD8DC" stroke="black" stroke-width="2"/><path d="M22 34 L 42 34 L 40 42 L 24 42 Z" fill="#795548" stroke="black" stroke-width="2"/><rect x="20" y="8" width="24" height="4" fill="#263238" stroke="black" stroke-width="2"/><circle cx="42" cy="18" r="2" fill="#39ff14"/></svg>`
                },
                clone: {
                    name: 'Angry Machine',
                    img: 'CardCoffeeMonster.png',
                    svg: `<svg viewBox="0 0 64 64" fill="none" class="cartoon-svg"><path d="M14 12 L 50 10 L 48 54 L 16 52 Z" fill="#546E7A" stroke="black" stroke-width="3"/><path d="M20 28 L 24 38 L 28 28 M 36 28 L 40 38 L 44 28" fill="white" stroke="black" stroke-width="2"/><circle cx="32" cy="20" r="6" fill="red" stroke="black" stroke-width="2"/><circle cx="32" cy="20" r="2" fill="black"/><path d="M10 40 Q 4 50, 12 58" stroke="#E91E63" stroke-width="4" stroke-linecap="round" fill="none"/><path d="M54 40 Q 60 50, 52 58" stroke="#E91E63" stroke-width="4" stroke-linecap="round" fill="none"/></svg>`
                }
            },
            {
                type: 'monitor',
                original: {
                    name: 'Monitor',
                    img: 'CardScreenNormal.png',
                    svg: `<svg viewBox="0 0 64 64" fill="none" class="cartoon-svg"><rect x="8" y="12" width="48" height="32" rx="2" fill="#B0BEC5" stroke="black" stroke-width="3"/><rect x="12" y="16" width="40" height="24" fill="#E0F7FA" stroke="black" stroke-width="2"/><path d="M24 44 L 20 54 L 44 54 L 40 44" fill="#78909C" stroke="black" stroke-width="3"/></svg>`
                },
                clone: {
                    name: 'Glitch Screen',
                    img: 'CardScreenMonster.png',
                    svg: `<svg viewBox="0 0 64 64" fill="none" class="cartoon-svg"><path d="M6 10 L 58 14 L 54 48 L 10 46 Z" fill="#546E7A" stroke="black" stroke-width="3"/><rect x="14" y="18" width="36" height="20" fill="#000" stroke="black"/><path d="M18 22 L 46 34" stroke="#39ff14" stroke-width="2"/><path d="M20 50 L 16 58 L 48 56 L 44 48" fill="#37474F" stroke="black" stroke-width="3"/></svg>`
                }
            },
            {
                type: 'robot',
                original: {
                    name: 'Robot',
                    img: 'CardRobotNormal.png',
                    svg: `<svg viewBox="0 0 64 64" fill="none" class="cartoon-svg"><rect x="20" y="16" width="24" height="20" rx="4" fill="#B39DDB" stroke="black" stroke-width="3"/><rect x="24" y="36" width="16" height="16" fill="#9575CD" stroke="black" stroke-width="3"/><circle cx="26" cy="24" r="2" fill="white"/><circle cx="38" cy="24" r="2" fill="white"/><line x1="28" y1="30" x2="36" y2="30" stroke="black" stroke-width="2"/></svg>`
                },
                clone: {
                    name: 'Rogue Bot',
                    img: 'CardRobotMonster.png',
                    svg: `<svg viewBox="0 0 64 64" fill="none" class="cartoon-svg"><path d="M18 14 L 46 18 L 44 40 L 22 38 Z" fill="#F48FB1" stroke="black" stroke-width="3"/><circle cx="28" cy="24" r="4" fill="red" stroke="black"/><circle cx="40" cy="22" r="2" fill="black"/><path d="M26 32 L 30 36 L 38 30" stroke="black" stroke-width="2" fill="none"/><path d="M44 26 L 52 20 M 20 24 L 12 18" stroke="#39ff14" stroke-width="3"/></svg>`
                }
            },
            {
                type: 'tablelight',
                original: {
                    name: 'Table Light',
                    img: 'TableLightOrig.png',
                    svg: `<svg viewBox="0 0 64 64" fill="none" class="cartoon-svg"><path d="M32 54 L 32 30" stroke="#795548" stroke-width="4"/><path d="M20 54 L 44 54" stroke="black" stroke-width="3"/><path d="M20 30 L 44 30 L 38 10 L 26 10 Z" fill="#FFF59D" stroke="black" stroke-width="3"/></svg>`
                },
                clone: {
                    name: 'Possessed Lamp',
                    img: 'TableLightMute.png',
                    svg: `<svg viewBox="0 0 64 64" fill="none" class="cartoon-svg"><path d="M32 54 Q 42 40, 32 30" stroke="#5D4037" stroke-width="4"/><path d="M20 30 L 44 34 L 40 10 L 24 14 Z" fill="#FFCC80" stroke="black" stroke-width="3"/><circle cx="32" cy="22" r="4" fill="#39ff14"/><path d="M22 54 L 42 56" stroke="black" stroke-width="3"/></svg>`
                }
            },
            // Keeping Microscope as 6th pair to maintain a nice rectangular grid
            {
                type: 'microscope',
                original: {
                    name: 'Microscope',
                    img: 'CardMicroNormal.png',
                    svg: `<svg viewBox="0 0 64 64" fill="none" class="cartoon-svg"><path d="M32 10 L 32 36" stroke="#90A4AE" stroke-width="6" stroke-linecap="round"/><path d="M24 36 L 40 36" stroke="black" stroke-width="3"/><path d="M20 54 L 44 54 L 48 48 L 16 48 Z" fill="#546E7A" stroke="black" stroke-width="3"/><circle cx="38" cy="46" r="4" fill="#37474F" stroke="black" stroke-width="2"/><path d="M28 10 L 36 10 L 40 18 L 24 18 Z" fill="#CFD8DC" stroke="black" stroke-width="2"/></svg>`
                },
                clone: {
                    name: 'Mutated Scope',
                    img: 'CardMicroMonster.png',
                    svg: `<svg viewBox="0 0 64 64" fill="none" class="cartoon-svg"><path d="M28 14 Q 20 24, 34 36" stroke="#EF9A9A" stroke-width="8" stroke-linecap="round"/><circle cx="28" cy="14" r="5" fill="#C62828" stroke="black"/><circle cx="28" cy="14" r="2" fill="yellow"/><path d="M22 54 L 46 54 L 48 50 L 18 46 Z" fill="#546E7A" stroke="black" stroke-width="3"/><path d="M40 30 Q 50 30, 48 40" stroke="#39ff14" stroke-width="4" fill="none"/><path d="M30 40 L 34 46 L 38 40" fill="white" stroke="black" stroke-width="1"/></svg>`
                }
            }
        ];

        // Game State
        let deck = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let moves = 0;
        let timer = 0;
        let timerInterval = null;
        let gameActive = false;
        let lockBoard = false;

        // DOM Elements
        const gridElement = document.getElementById('game-grid');
        const movesElement = document.getElementById('move-count');
        const timerElement = document.getElementById('timer');
        const modalElement = document.getElementById('victory-modal');
        const modalContent = document.getElementById('modal-content');
        const finalMovesElement = document.getElementById('final-moves');
        const finalTimeElement = document.getElementById('final-time');
        const introLayer = document.getElementById('intro-layer');
        const startBtn = document.getElementById('start-btn');
        const startScreen = document.getElementById('start-screen');
        const introVideo = document.getElementById('intro-video');
        const gameContainer = document.getElementById('game-container');

        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            
            // INTRO LOGIC
            startBtn.addEventListener('click', () => {
                startScreen.style.display = 'none';
                introVideo.style.display = 'block';
                
                // Only when clicked do we attempt to play
                introVideo.play().then(() => {
                    // Video playing successfully
                }).catch(e => {
                    // If video fails to play (codec issue etc), skip to game
                    console.error("Video play error", e);
                    startGameSequence();
                });
            });

            introVideo.addEventListener('ended', () => {
                startGameSequence();
            });

            introVideo.addEventListener('error', (e) => {
                console.error("Video source error", e);
                startGameSequence();
            });
        });

        function startGameSequence() {
            // Fade out video layer
            introLayer.style.opacity = '0';
            setTimeout(() => {
                introLayer.style.display = 'none';
                // Show game container
                gameContainer.style.display = 'block';
                // Trigger reflow
                void gameContainer.offsetWidth;
                // Fade in
                gameContainer.style.opacity = '1';
                
                initGame(); // Start Game
            }, 1000);
        }

        function initGame() {
            deck = [];
            pairedAssets.forEach((pair, index) => {
                // Modified: Now creates pairs of (Original + Clone)
                
                // Card 1: Original
                deck.push({ 
                    id: `orig-${index}`, 
                    type: pair.type, 
                    isClone: false, 
                    data: pair.original, // Show Original Image
                    originalData: pair.original // Final State is Original
                });
                
                // Card 2: Clone
                deck.push({ 
                    id: `clone-${index}`, 
                    type: pair.type, 
                    isClone: true, 
                    data: pair.clone, // Show Clone Image
                    originalData: pair.original // Final State is Original (transform)
                });
            });
            shuffle(deck);

            flippedCards = [];
            matchedPairs = 0;
            moves = 0;
            timer = 0;
            gameActive = true;
            lockBoard = false;

            movesElement.textContent = '0';
            timerElement.textContent = '00:00';
            clearInterval(timerInterval);
            timerInterval = setInterval(updateTimer, 1000);
            
            renderGrid();
            modalElement.classList.add('hidden');
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        function generateCardContent(data) {
            return `
                <div class="relative w-full h-full flex items-center justify-center asset-content overflow-hidden">
                    <div class="absolute inset-0 z-0 opacity-20">
                        ${data.svg}
                    </div>
                    ${data.img ? `
                    <img 
                        src="${data.img}" 
                        class="relative z-10 w-full h-full object-contain p-0 transition-opacity duration-200" 
                        onerror="this.style.opacity='0'"
                        alt="${data.name}"
                    />` : ''}
                </div>
            `;
        }

        function renderGrid() {
            gridElement.innerHTML = '';
            
            deck.forEach((cardData, index) => {
                const cardElement = document.createElement('div');
                const randomRot = Math.random() * 4 - 2; 
                // Using new custom aspect ratio class and removed fixed h-32/h-40
                // We rely on grid layout + aspect ratio to size them
                cardElement.className = 'card card-custom-ratio relative w-full';
                cardElement.style.setProperty('--rot-start', `${randomRot}deg`);
                cardElement.style.transform = `rotate(${randomRot}deg)`;
                cardElement.dataset.type = cardData.type;
                cardElement.dataset.id = cardData.id;

                let contentHtml = generateCardContent(cardData.data);

                cardElement.innerHTML = `
                    <div class="card-inner w-full h-full transition-all duration-500">
                        <!-- FRONT OF CARD (FACE DOWN) WITH CUSTOM IMAGE -->
                        <div class="card-face card-front"></div>
                        
                        <!-- BACK OF CARD (REVEALED) -->
                        <div class="card-face card-back flex flex-col items-center justify-center p-0">
                            <div class="matched-slime"></div>
                            ${contentHtml}
                        </div>
                    </div>
                `;

                cardElement.addEventListener('click', () => handleCardClick(cardElement));
                gridElement.appendChild(cardElement);
            });
            
            lucide.createIcons();
        }

        function handleCardClick(cardElement) {
            if (lockBoard || cardElement.classList.contains('flipped') || cardElement.classList.contains('matched') || !gameActive) return;

            cardElement.classList.add('flipped');
            flippedCards.push(cardElement);

            if (flippedCards.length === 2) {
                moves++;
                movesElement.textContent = moves;
                lockBoard = true; 
                setTimeout(checkForMatch, 800);
            }
        }

        function checkForMatch() {
            const [card1, card2] = flippedCards;
            const isMatch = card1.dataset.type === card2.dataset.type;

            if (isMatch) {
                disableCards();
            } else {
                unflipCards();
            }
        }

        function disableCards() {
            const [card1, card2] = flippedCards;
            
            // --- ANIMATION CALCULATION ---
            const rect1 = card1.getBoundingClientRect();
            const rect2 = card2.getBoundingClientRect();
            
            const center1X = rect1.left + rect1.width / 2;
            const center1Y = rect1.top + rect1.height / 2;
            const center2X = rect2.left + rect2.width / 2;
            const center2Y = rect2.top + rect2.height / 2;
            
            const midX = (center1X + center2X) / 2;
            const midY = (center1Y + center2Y) / 2;
            
            // Calculate vector to center for each card
            const tx1 = midX - center1X;
            const ty1 = midY - center1Y;
            const tx2 = midX - center2X;
            const ty2 = midY - center2Y;
            
            // Set props for animation
            card1.style.setProperty('--tx', `${tx1}px`);
            card1.style.setProperty('--ty', `${ty1}px`);
            card2.style.setProperty('--tx', `${tx2}px`);
            card2.style.setProperty('--ty', `${ty2}px`);
            
            // Trigger Animation
            card1.classList.add('merging');
            card2.classList.add('merging');

            // --- MID-ANIMATION SWAP (at 500ms) ---
            setTimeout(() => {
                // Find data
                const card1OriginalData = deck.find(c => c.id === card1.dataset.id).originalData;
                const card2OriginalData = deck.find(c => c.id === card2.dataset.id).originalData;
                
                // Helper to update DOM
                const updateCardDOM = (cardEl, originalData) => {
                    const assetContainer = cardEl.querySelector('.asset-content').parentElement;
                    
                    // Replace content with new image (without text)
                    assetContainer.innerHTML = `
                        <div class="matched-slime"></div>
                        ${generateCardContent(originalData)}
                    `;
                };
                
                updateCardDOM(card1, card1OriginalData);
                updateCardDOM(card2, card2OriginalData);

            }, 500); // Swap content while they are touching/glowing

            // --- CLEANUP (at 1200ms) ---
            setTimeout(() => {
                card1.classList.remove('merging');
                card2.classList.remove('merging');
                card1.classList.add('matched');
                card2.classList.add('matched');

                matchedPairs++;
                flippedCards = [];
                lockBoard = false;
                
                if (matchedPairs === pairedAssets.length) {
                    clearInterval(timerInterval);
                    // Delay calling endGame so user can see the final merge
                    setTimeout(endGame, 1500);
                }
            }, 1200);
        }

        function unflipCards() {
            // Already waited 800ms to get here, wait another 1000ms for viewing
            setTimeout(() => {
                flippedCards.forEach(card => card.classList.remove('flipped'));
                flippedCards = [];
                lockBoard = false;
            }, 1000);
        }

        function updateTimer() {
            if (!gameActive) return;
            timer++;
            const minutes = Math.floor(timer / 60);
            const seconds = timer % 60;
            timerElement.textContent = `${minutes < 10 ? '0' : ''}${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }

        function endGame() {
            gameActive = false;
            clearInterval(timerInterval);
            modalElement.classList.remove('hidden');
            finalMovesElement.textContent = moves;
            finalTimeElement.textContent = timerElement.textContent;
            setTimeout(() => {
                modalContent.classList.remove('scale-90', 'opacity-0');
                modalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        function restartGame() {
            modalContent.classList.remove('scale-100', 'opacity-100');
            modalContent.classList.add('scale-100', 'opacity-0');
            setTimeout(() => {
                modalElement.classList.add('hidden');
                initGame();
            }, 300);
        }
    </script>
</body>
</html>